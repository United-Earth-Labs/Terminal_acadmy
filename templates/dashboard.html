{% extends 'base.html' %}

{% block title %}Dashboard - Terminal Academy{% endblock %}

{% block content %}
<section style="padding: var(--space-2xl) 0;">
    <div class="container">
        <!-- Welcome Header -->
        <div style="margin-bottom: var(--space-2xl);">
            <h1>Welcome back, {{ user.display_name }}!</h1>
            <p>Continue your ethical hacking journey</p>
        </div>

        <!-- Stats Overview -->
        <!-- Welcome Card for New Users -->
        {% if is_new_user %}
        <div class="welcome-card" id="welcome-card" style="margin-bottom: var(--space-2xl);">
            <button class="welcome-close" onclick="dismissWelcome()" aria-label="Close">√ó</button>
            <h2 style="margin-bottom: var(--space-md);">üéì Welcome to Terminal Academy!</h2>
            <p style="color: var(--text-secondary); margin-bottom: var(--space-lg);">
                Start your ethical hacking journey with these quick steps:
            </p>
            <div class="welcome-tips">
                <div class="welcome-tip">
                    <span class="tip-number">1</span>
                    <div>
                        <strong>Complete your Skill Assessment</strong>
                        <p>Find the right starting point for your level</p>
                    </div>
                </div>
                <div class="welcome-tip">
                    <span class="tip-number">2</span>
                    <div>
                        <strong>Start with Linux Fundamentals</strong>
                        <p>Build a strong foundation in command-line basics</p>
                    </div>
                </div>
                <div class="welcome-tip">
                    <span class="tip-number">3</span>
                    <div>
                        <strong>Try your first lab</strong>
                        <p>Hands-on practice to earn XP and level up</p>
                    </div>
                </div>
                <div class="welcome-tip">
                    <span class="tip-number">4</span>
                    <div>
                        <strong>Unlock Achievements</strong>
                        <p>Track your progress and earn badges</p>
                    </div>
                </div>
            </div>
            <div style="margin-top: var(--space-lg); display: flex; gap: var(--space-md);">
                <a href="/skill-assessment/" class="btn btn-primary">Take Assessment</a>
                <a href="/courses/" class="btn btn-secondary">Browse Courses</a>
            </div>
        </div>
        {% endif %}

        <!-- Stats Overview -->
        <div class="stats-grid" style="margin-bottom: var(--space-2xl);">
            <div class="stat-card">
                <div class="stat-value" id="user-xp">0</div>
                <div class="stat-label">
                    Total XP
                    <span class="tooltip-container">
                        <span class="tooltip-icon">‚ÑπÔ∏è</span>
                        <span class="tooltip-text">Experience Points - Earn XP by completing labs, courses, and challenges. More XP = higher level!</span>
                    </span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="user-level">1</div>
                <div class="stat-label">
                    Level
                    <span class="tooltip-container">
                        <span class="tooltip-icon">‚ÑπÔ∏è</span>
                        <span class="tooltip-text">Your current skill level based on total XP. Higher levels unlock advanced content.</span>
                    </span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="user-streak">0</div>
                <div class="stat-label">
                    Day Streak üî•
                    <span class="tooltip-container">
                        <span class="tooltip-icon">‚ÑπÔ∏è</span>
                        <span class="tooltip-text">Consecutive days you've been active. Login daily to maintain your streak and earn bonus XP!</span>
                    </span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="labs-completed">0</div>
                <div class="stat-label">Labs Completed</div>
            </div>
        </div>

        <!-- Level Progress -->
        <div class="card" style="margin-bottom: var(--space-2xl);">
            <h3>Level Progress</h3>
            <div class="progress-bar" style="margin: var(--space-md) 0;">
                <div class="progress-fill" id="level-progress" style="width: 0%;"></div>
            </div>
            <p style="font-size: 0.9rem; margin: 0;">
                <span id="xp-current">0</span> / <span id="xp-needed">100</span> XP to Level <span
                    id="next-level">2</span>
            </p>
        </div>

        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: var(--space-xl);">
            <!-- Continue Learning -->
            <div>
                <h2 style="margin-bottom: var(--space-lg);">Continue Learning</h2>

                <div class="card" style="margin-bottom: var(--space-lg);">
                    <div class="card-header">
                        <div>
                            <span class="badge badge-beginner">In Progress</span>
                            <h3 style="margin-top: var(--space-sm); margin-bottom: 0;">Linux Fundamentals</h3>
                        </div>
                        <span style="font-size: 1.5rem;">üêß</span>
                    </div>
                    <div class="progress-bar" style="margin: var(--space-md) 0;">
                        <div class="progress-fill" style="width: 45%;"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="color: var(--text-muted);">45% Complete</span>
                        <a href="/courses/linux-fundamentals/" class="btn btn-primary">Continue</a>
                    </div>
                </div>

                <h2 style="margin-bottom: var(--space-lg);">Recommended Next</h2>

                <div class="course-grid" style="grid-template-columns: 1fr 1fr;">
                    <a href="/courses/" class="course-card" style="text-decoration: none; color: inherit;">
                        <div class="course-thumbnail" style="height: 100px;">üåê</div>
                        <div class="course-content">
                            <span class="badge badge-intermediate">Intermediate</span>
                            <h4 style="margin-top: var(--space-sm);">Web Security Basics</h4>
                            <div class="course-meta">
                                <span>15 Lessons</span>
                                <span>+350 XP</span>
                            </div>
                        </div>
                    </a>

                    <a href="/courses/" class="course-card" style="text-decoration: none; color: inherit;">
                        <div class="course-thumbnail" style="height: 100px;">üîå</div>
                        <div class="course-content">
                            <span class="badge badge-beginner">Beginner</span>
                            <h4 style="margin-top: var(--space-sm);">Networking Essentials</h4>
                            <div class="course-meta">
                                <span>10 Lessons</span>
                                <span>+200 XP</span>
                            </div>
                        </div>
                    </a>
                </div>
            </div>

            <!-- Sidebar -->
            <div>
                <h3 style="margin-bottom: var(--space-lg);">Recent Achievements</h3>

                <div class="card" style="margin-bottom: var(--space-md);">
                    <div style="display: flex; align-items: center; gap: var(--space-md);">
                        <span style="font-size: 2rem;">üéØ</span>
                        <div>
                            <strong>First Steps</strong>
                            <p style="margin: 0; font-size: 0.85rem;">Complete your first lesson</p>
                        </div>
                    </div>
                </div>

                <div class="card" style="margin-bottom: var(--space-md);">
                    <div style="display: flex; align-items: center; gap: var(--space-md);">
                        <span style="font-size: 2rem;">üíª</span>
                        <div>
                            <strong>Terminal Novice</strong>
                            <p style="margin: 0; font-size: 0.85rem;">Run 100 commands</p>
                        </div>
                    </div>
                </div>

                <a href="/achievements/" class="btn btn-secondary" style="width: 100%; justify-content: center;">
                    View All Achievements
                </a>

                <h3 style="margin: var(--space-xl) 0 var(--space-lg);">Quick Actions</h3>

                <a href="/labs/" class="btn btn-primary"
                    style="width: 100%; justify-content: center; margin-bottom: var(--space-md);">
                    üñ•Ô∏è Launch Lab
                </a>

                <a href="/leaderboard/" class="btn btn-secondary" style="width: 100%; justify-content: center;">
                    üèÜ View Leaderboard
                </a>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    // Fetch and display user stats
    async function loadStats() {
        try {
            const response = await fetch('/api/v1/progress/stats/', {
                headers: {
                    'Content-Type': 'application/json',
                },
                credentials: 'same-origin'
            });

            if (response.ok) {
                const stats = await response.json();
                document.getElementById('user-xp').textContent = stats.xp.toLocaleString();
                document.getElementById('user-level').textContent = stats.level;
                document.getElementById('user-streak').textContent = stats.streak;
                document.getElementById('labs-completed').textContent = stats.labs_completed;
                document.getElementById('level-progress').style.width = stats.xp_progress + '%';
                document.getElementById('xp-current').textContent = stats.xp;
                document.getElementById('xp-needed').textContent = stats.xp_for_next_level;
                document.getElementById('next-level').textContent = stats.level + 1;
            }
        } catch (err) {
            console.error('Failed to load stats:', err);
        }
    }

    document.addEventListener('DOMContentLoaded', loadStats);

    // Welcome card dismissal
    function dismissWelcome() {
        const card = document.getElementById('welcome-card');
        if (card) {
            card.style.animation = 'fadeOut 0.3s ease-out';
            setTimeout(() => {
                card.style.display = 'none';
                // Save dismissal to localStorage
                localStorage.setItem('welcomeCardDismissed', 'true');
            }, 300);
        }
    }

    // Check if welcome card was previously dismissed
    document.addEventListener('DOMContentLoaded', () => {
        const card = document.getElementById('welcome-card');
        if (card && localStorage.getItem('welcomeCardDismissed') === 'true') {
            card.style.display = 'none';
        }
    });
</script>
{% endblock %}